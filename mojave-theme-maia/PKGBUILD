# Maintainer: Jacob Birkett <ved.ttekrib@bocaj>
# Contriburor: Vince Liuice <moc.liamtoh@eciuilecniv>

# shellcheck shell=bash
# shellcheck disable=SC2034,SC2154,SC2115

pkgbase='mojave-theme-maia'
pkgname=(
    "$pkgbase-light"
    "$pkgbase-light-solid"
    "$pkgbase-light-alt"
    "$pkgbase-light-solid-alt"
    "$pkgbase-dark"
    "$pkgbase-dark-solid"
    "$pkgbase-dark-alt"
    "$pkgbase-dark-solid-alt"
    "$pkgbase-blackish"
    "$pkgbase-blackish-solid"
    "$pkgbase-blackish-alt"
    "$pkgbase-blackish-solid-alt"
)
pkgver=r452.b4d36a6
pkgrel=1
pkgdesc="A spin of vinceliuice's Mojave theme for GTK with Manjaro Maia colors and a darker variant."
arch=('any')
url='https://github.com/vinceliuice/Mojave-gtk-theme'
license=('GPL3')
depends=()
makedepends=('git' 'meson')
optdepends=(
    'mcmojave-cursors: matching cursor theme'
    'mcmojave-circle-icon-theme: matching icon theme'
)
_clonedir="${url##*/}"
source=("$_clonedir::git+$url.git")
sha256sums=('SKIP')

_THEME_DEFAULT_SMALL_VARIANT='standard'
_THEME_DEFAULT_ICON_VARIANT='manjaro'
_THEME_REPLACE_COLOR='red'

pkgver() {
    cd "$srcdir/$_clonedir" || exit 1
    printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

prepare() {
    [[ -d "$srcdir/build" ]] && rm -rf "$srcdir/build"
    mkdir -p "$srcdir/build"

    [[ -d "$srcdir/$pkgbase" ]] && rm -rf "$srcdir/$pkgbase"
    cp -r "$srcdir/$_clonedir/" "$srcdir/$pkgbase"

    # shellcheck disable=SC2016
    {
        local patch_from='${SRC_DIR}/other/plank/${name}${color}/'
        local patch_to='${SRC_DIR}/other/plank/Mojave${color}/'
        sed -i "s,$patch_from,$patch_to," "$srcdir/$pkgbase/install.sh"
    }

    [[ -d "$srcdir/$pkgbase-blackish" ]] && rm -rf "$srcdir/$pkgbase-blackish"
    cp -r "$srcdir/$pkgbase/" "$srcdir/$pkgbase-blackish"
}

_build_themes() {
    local args=(
        --dest "$_THEME_DEST_DIR"
        --name "$_THEME_BASE_NAME"
    )

    for color in "${_THEME_COLOR_VARIANTS[@]}"; do
        args+=(--color "$color")
    done
    for opacity in "${_THEME_OPACITY_VARIANTS[@]}"; do
        args+=(--opacity "$opacity")
    done
    for alt in "${_THEME_ALT_VARIANTS[@]}"; do
        args+=(--alt "$alt")
    done
    for small in "${_THEME_SMALL_VARIANTS[@]}"; do
        args+=(--small "$small")
    done
    for theme in "${_THEME_THEME_VARIANTS[@]}"; do
        args+=(--theme "$theme")
    done
    for icon in "${_THEME_ICON_VARIANTS[@]}"; do
        args+=(--icon "$icon")
    done

    "$_THEME_SOURCE_DIR/install.sh" "${args[@]}"
}

_fixup_mojave-theme-maia-light() {
    local build_name="$pkgbase-light-$_THEME_REPLACE_COLOR"
    local theme_name="$pkgbase-light"

    mv "$srcdir/$pkgbase/build/$build_name/" "$srcdir/build/$theme_name"
    cd "$srcdir/build/$theme_name" || exit 1
}

_fixup_mojave-theme-maia-light-solid() {
    local build_name="$pkgbase-light-solid-$_THEME_REPLACE_COLOR"
    local theme_name="$pkgbase-light-solid"

    mv "$srcdir/$pkgbase/build/$build_name/" "$srcdir/build/$theme_name"
    cd "$srcdir/build/$theme_name" || exit 1
}

_fixup_mojave-theme-maia-light-alt() {
    local build_name="$pkgbase-light-alt-$_THEME_REPLACE_COLOR"
    local theme_name="$pkgbase-light-alt"

    mv "$srcdir/$pkgbase/build/$build_name/" "$srcdir/build/$theme_name"
    cd "$srcdir/build/$theme_name" || exit 1
}

_fixup_mojave-theme-maia-light-solid-alt() {
    local build_name="$pkgbase-light-solid-alt-$_THEME_REPLACE_COLOR"
    local theme_name="$pkgbase-light-solid-alt"

    mv "$srcdir/$pkgbase/build/$build_name/" "$srcdir/build/$theme_name"
    cd "$srcdir/build/$theme_name" || exit 1
}

_fixup_mojave-theme-maia-dark() {
    local build_name="$pkgbase-dark-$_THEME_REPLACE_COLOR"
    local theme_name="$pkgbase-dark"

    mv "$srcdir/$pkgbase/build/$build_name/" "$srcdir/build/$theme_name"
    cd "$srcdir/build/$theme_name" || exit 1
}

_fixup_mojave-theme-maia-dark-solid() {
    local build_name="$pkgbase-dark-solid-$_THEME_REPLACE_COLOR"
    local theme_name="$pkgbase-dark-solid"

    mv "$srcdir/$pkgbase/build/$build_name/" "$srcdir/build/$theme_name"
    cd "$srcdir/build/$theme_name" || exit 1
}

_fixup_mojave-theme-maia-dark-alt() {
    local build_name="$pkgbase-dark-alt-$_THEME_REPLACE_COLOR"
    local theme_name="$pkgbase-dark-alt"

    mv "$srcdir/$pkgbase/build/$build_name/" "$srcdir/build/$theme_name"
    cd "$srcdir/build/$theme_name" || exit 1
}

_fixup_mojave-theme-maia-dark-solid-alt() {
    local build_name="$pkgbase-dark-solid-alt-$_THEME_REPLACE_COLOR"
    local theme_name="$pkgbase-dark-solid-alt"

    mv "$srcdir/$pkgbase/build/$build_name/" "$srcdir/build/$theme_name"
    cd "$srcdir/build/$theme_name" || exit 1
}

_fixup_mojave-theme-maia-blackish() {
    local build_name="$pkgbase-blackish-dark-$_THEME_REPLACE_COLOR"
    local theme_name="$pkgbase-blackish"

    mv "$srcdir/$pkgbase-blackish/build/$build_name/" "$srcdir/build/$theme_name"
    cd "$srcdir/build/$theme_name" || exit 1
}

_fixup_mojave-theme-maia-blackish-solid() {
    local build_name="$pkgbase-blackish-dark-solid-$_THEME_REPLACE_COLOR"
    local theme_name="$pkgbase-blackish-solid"

    mv "$srcdir/$pkgbase-blackish/build/$build_name/" "$srcdir/build/$theme_name"
    cd "$srcdir/build/$theme_name" || exit 1
}

_fixup_mojave-theme-maia-blackish-alt() {
    local build_name="$pkgbase-blackish-dark-alt-$_THEME_REPLACE_COLOR"
    local theme_name="$pkgbase-blackish-alt"

    mv "$srcdir/$pkgbase-blackish/build/$build_name/" "$srcdir/build/$theme_name"
    cd "$srcdir/build/$theme_name" || exit 1
}

_fixup_mojave-theme-maia-blackish-solid-alt() {
    local build_name="$pkgbase-blackish-dark-solid-alt-$_THEME_REPLACE_COLOR"
    local theme_name="$pkgbase-blackish-solid-alt"

    mv "$srcdir/$pkgbase-blackish/build/$build_name/" "$srcdir/build/$theme_name"
    cd "$srcdir/build/$theme_name" || exit 1
}

build() {
    _THEME_SMALL_VARIANTS=("$_THEME_DEFAULT_SMALL_VARIANT")
    _THEME_THEME_VARIANTS=("$_THEME_REPLACE_COLOR")
    _THEME_ICON_VARIANTS=("$_THEME_DEFAULT_ICON_VARIANT")

    _THEME_SOURCE_DIR="$srcdir/$pkgbase"
    _THEME_DEST_DIR="$srcdir/$pkgbase/build"
    _THEME_BASE_NAME="$pkgbase"

    _THEME_COLOR_VARIANTS=('light' 'dark')
    _THEME_OPACITY_VARIANTS=('standard' 'solid')
    _THEME_ALT_VARIANTS=('standard' 'alt')

    _build_themes

    _THEME_SOURCE_DIR="$srcdir/$pkgbase-blackish"
    _THEME_DEST_DIR="$srcdir/$pkgbase-blackish/build"
    _THEME_BASE_NAME="$pkgbase-blackish"

    _THEME_COLOR_VARIANTS=('dark')

    _build_themes

    _fixup_mojave-theme-maia-light
    _fixup_mojave-theme-maia-light-solid
    _fixup_mojave-theme-maia-light-alt
    _fixup_mojave-theme-maia-light-solid-alt
    _fixup_mojave-theme-maia-dark
    _fixup_mojave-theme-maia-dark-solid
    _fixup_mojave-theme-maia-dark-alt
    _fixup_mojave-theme-maia-dark-solid-alt

    _fixup_mojave-theme-maia-blackish
    _fixup_mojave-theme-maia-blackish-solid
    _fixup_mojave-theme-maia-blackish-alt
    _fixup_mojave-theme-maia-blackish-solid-alt
}

package_mojave-theme-maia-light() {
    cd "$srcdir/build/$pkgbase-light" || exit 1
}

package_mojave-theme-maia-light-solid() {
    cd "$srcdir/build/$pkgbase-light-solid" || exit 1
}

package_mojave-theme-maia-light-alt() {
    cd "$srcdir/build/$pkgbase-light-alt" || exit 1
}

package_mojave-theme-maia-light-solid-alt() {
    cd "$srcdir/build/$pkgbase-light-solid-alt" || exit 1
}

package_mojave-theme-maia-dark() {
    cd "$srcdir/build/$pkgbase-dark" || exit 1
}

package_mojave-theme-maia-dark-solid() {
    cd "$srcdir/build/$pkgbase-dark-solid" || exit 1
}

package_mojave-theme-maia-dark-alt() {
    cd "$srcdir/build/$pkgbase-dark-alt" || exit 1
}

package_mojave-theme-maia-dark-solid-alt() {
    cd "$srcdir/build/$pkgbase-dark-solid-alt" || exit 1
}

package_mojave-theme-maia-blackish() {
    cd "$srcdir/build/$pkgbase-blackish" || exit 1
}

package_mojave-theme-maia-blackish-solid() {
    cd "$srcdir/build/$pkgbase-blackish-solid" || exit 1
}

package_mojave-theme-maia-blackish-alt() {
    cd "$srcdir/build/$pkgbase-blackish-alt" || exit 1
}

package_mojave-theme-maia-blackish-solid-alt() {
    cd "$srcdir/build/$pkgbase-blackish-solid-alt" || exit 1
}
